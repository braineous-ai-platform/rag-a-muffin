{
  "rulepack_id": "flight_graph_basic",
  "version": "0.1.0",
  "description": "Map flight facts to a graph: airports as nodes, flights as edges; attach attributes and compute simple metrics.",
  "rules": [
    {
      "id": "R_airport_node",
      "note": "Create an airport graph node from Airport(code, name) facts.",
      "when": [
        "Airport($code, $name)"
      ],
      "then": [
        {
          "emit": "GraphNode($code, 'airport', $name)"
        }
      ],
      "weight": 0.8
    },
    {
      "id": "R_flight_edge",
      "note": "Create a flight edge from Flight(fid, src, dst).",
      "when": [
        "Flight($fid, $src, $dst)"
      ],
      "then": [
        {
          "emit": "GraphEdge($fid, 'flight', $src, $dst)"
        }
      ],
      "weight": 1.0
    },
    {
      "id": "R_operated_by",
      "note": "Attach airline metadata to the flight edge.",
      "when": [
        "OperatedBy($fid, $airline)"
      ],
      "then": [
        {
          "emit": "EdgeAttr($fid, 'airline', $airline)"
        }
      ],
      "weight": 0.6
    },
    {
      "id": "R_codeshare",
      "note": "Attach codeshare flight information.",
      "when": [
        "CodesharedWith($fid, $csFlight, $csAirline)"
      ],
      "then": [
        {
          "emit": "EdgeAttr($fid, 'codeshare_flight', $csFlight)"
        },
        {
          "emit": "EdgeAttr($fid, 'codeshare_airline', $csAirline)"
        }
      ],
      "weight": 0.6
    },
    {
      "id": "R_schedule",
      "note": "Attach scheduled departure/arrival timestamps.",
      "when": [
        "ScheduledDeparture($fid, $depTs)",
        "ScheduledArrival($fid, $arrTs)"
      ],
      "then": [
        {
          "emit": "EdgeAttr($fid, 'scheduled_departure', $depTs)"
        },
        {
          "emit": "EdgeAttr($fid, 'scheduled_arrival', $arrTs)"
        }
      ],
      "weight": 0.7
    },
    {
      "id": "R_duration_from_schedule",
      "note": "Derive duration in minutes from scheduled timestamps, if present.",
      "when": [
        "ScheduledDeparture($fid, $depTs)",
        "ScheduledArrival($fid, $arrTs)"
      ],
      "then": [
        {
          "emit": "EdgeAttr($fid, 'duration_min', DiffMinutes($arrTs, $depTs))"
        }
      ],
      "weight": 0.7
    },
    {
      "id": "R_duration_fact_passthrough",
      "note": "If a duration fact is already present, attach it (acts as fallback).",
      "when": [
        "FlightDuration($fid, $min)"
      ],
      "then": [
        {
          "emit": "EdgeAttr($fid, 'duration_min', $min)"
        }
      ],
      "weight": 0.4
    }
  ],
  "metrics": [
    {
      "id": "M_rule_density",
      "note": "Average number of rules fired per flight edge.",
      "calc": "countRulesFired() / countEdges(type='flight')"
    },
    {
      "id": "M_derivation_rate",
      "note": "Proportion of edges with at least one derived attribute.",
      "calc": "countEdgesWithAttrs(type='flight') / countEdges(type='flight')"
    },
    {
      "id": "M_confidence_mean",
      "note": "Mean confidence over all emitted facts (if your engine tracks it).",
      "calc": "mean(confidence(emittedFacts()))"
    }
  ]
}